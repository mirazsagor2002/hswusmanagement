<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>হযরত সৈয়দ ওয়াইছ উদ্দিন শাহ্ (রহঃ) – চাঁদা ও আয়-ব্যয়</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Nikosh', 'SolaimanLipi', sans-serif;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #2d8c5e;
            --accent: #d4af37;
            --dark: #0d2b3e;
            --light: #f8f5e9;
            --card-bg: #ffffff;
            --border: #d9c7a7;
            --success: #2d8c5e;
            --warning: #c57c1a;
            --info: #1a5f7a;
            --text: #2c3e50;
            --shadow: rgba(26, 95, 122, 0.1);
            --cash: #8b4513;
            --income: #2d8c5e;
            --expense: #e74c3c;
        }

        body {
            background: linear-gradient(135deg, #f0f4f8 0%, #e8f0f7 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(26, 95, 122, 0.2);
            color: white;
            border-bottom: 5px solid var(--accent);
        }

        .logo-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
        }

        .logo {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            overflow: hidden;
            border: 4px solid white;
        }

        .logo img {
            width: 90%;
            height: 90%;
            object-fit: cover;
            border-radius: 50%;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .date {
            font-size: 1.1rem;
            color: #f8de7e;
            margin-bottom: 10px;
        }

        .chanda-text {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--accent);
            background: rgba(0,0,0,0.2);
            display: inline-block;
            padding: 8px 25px;
            border-radius: 50px;
            border: 2px solid var(--accent);
        }

        /* বাটন গ্রিড */
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .area-btn {
            background: white;
            border: none;
            border-radius: 15px;
            padding: 16px 8px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 20px var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border-top: 5px solid var(--primary);
            transition: all 0.3s;
            font-size: 1rem;
        }
        .area-btn:hover { transform: translateY(-5px); box-shadow: 0 15px 25px rgba(26,95,122,0.25); }
        .area-icon { font-size: 1.8rem; }

        /* টেবিল কন্টেইনার */
        .table-container {
            background: white;
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 10px 30px var(--shadow);
            margin-bottom: 30px;
            display: none;
            overflow-x: auto;
            border: 1px solid var(--border);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-title {
            font-size: 1.5rem;
            color: var(--primary);
            padding-left: 12px;
            border-left: 5px solid var(--primary);
        }

        /* প্রিন্ট বাটন */
        .print-btn {
            background: linear-gradient(135deg, var(--primary), #0f4a63);
            border: none;
            padding: 10px 22px;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            box-shadow: 0 5px 12px rgba(26,95,122,0.4);
            transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .print-btn:hover { background: linear-gradient(135deg, #0f4a63, #1a5f7a); transform: scale(1.02); }

        /* সার্চ */
        .search-container {
            margin-bottom: 20px;
            position: relative;
        }
        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-size: 1rem;
            background: white;
        }
        .search-input:focus { outline: none; border-color: var(--primary); }
        .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary); }
        .search-help { font-size: 0.9rem; margin-top: 6px; color: var(--text); opacity: 0.8; }

        /* নো রেজাল্ট */
        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: var(--warning);
            display: none;
            background: rgba(255,248,225,0.7);
            border-radius: 16px;
        }

        /* টেবিল */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        thead {
            background: var(--primary);
            color: white;
        }
        th, td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        th { white-space: nowrap; font-weight: 700; }
        tr:hover { background: rgba(26,95,122,0.05); }
        tr:nth-child(even) { background: #f9f9f9; }

        /* স্ট্যাটাস */
        .paid { color: var(--success); font-weight: 700; padding-left: 20px; position: relative; }
        .paid::before { content: "\f00c"; font-family: "Font Awesome 5 Free"; font-weight: 900; position: absolute; left: 0; }
        .pending { color: var(--warning); font-weight: 700; padding-left: 20px; position: relative; }
        .pending::before { content: "\f252"; font-family: "Font Awesome 5 Free"; font-weight: 900; position: absolute; left: 0; }

        /* সারাংশ */
        .summary {
            background: #f1f7fa;
            padding: 20px;
            border-radius: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            border: 1px solid var(--border);
        }
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid var(--primary);
            box-shadow: 0 3px 8px rgba(0,0,0,0.03);
        }
        .summary-label { font-weight: 600; font-size: 0.95rem; margin-bottom: 5px; color: #2c3e50; }
        .summary-value { font-weight: 800; font-size: 1.3rem; color: var(--primary); }

        /* লোডিং */
        .loading { display: flex; justify-content: center; padding: 30px; display: none; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e0e0e0; border-radius: 50%; border-top: 4px solid var(--primary); animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ফুটার */
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--primary);
            background: rgba(255,255,255,0.7);
            border-radius: 15px;
            border-top: 1px solid var(--border);
        }

        /* A4 প্রিন্ট অপটিমাইজেশান – ৩০ সারি */
        @media print {
            body * { visibility: hidden; }
            .table-container, .table-container * { visibility: visible; }
            .table-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                box-shadow: none;
                border: none;
                padding: 0.3in 0.2in;
            }
            .print-btn, .search-container, .buttons-grid, header, footer, .logo-container, .date, .chanda-text, .search-help, .no-results, .loading {
                display: none !important;
            }
            h1 { display: none; }
            .table-title { font-size: 1.4rem; color: black; border-left-color: black; }
            th { background: #333 !important; color: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .summary { background: #f5f5f5; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
            thead { display: table-header-group; }
            tfoot { display: table-footer-group; }
            /* A4 সাইজে ৩০টি সারি থাকবে – সহজেই দেখা যাবে */
            tbody tr { height: auto; }
        }

        /* ছোট পর্দা */
        @media (max-width: 600px) {
            .buttons-grid { grid-template-columns: repeat(2, 1fr); }
            .table-header { flex-direction: column; align-items: start; }
        }

        /* হাইলাইট */
        .highlight { background-color: #fff0b5; font-weight: 600; padding: 0 2px; border-radius: 4px; }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo-container">
            <div class="logo">
                <img src="https://i.imgur.com/iA88Sk4.jpeg" alt="লোগো" onerror="this.src='https://i.imgur.com/6JcYJ5N.png'">
            </div>
        </div>
        <h1>হযরত সৈয়দ ওয়াইছ উদ্দিন শাহ্ (রহঃ)</h1>
        <div class="date">২২শে মাঘ, ৫ই ফেব্রুয়ারী ২০২৬ ইং</div>
        <div class="chanda-text">সামাজিক চাঁদার হিসাব</div>
    </header>

    <!-- এলাকা বাটন -->
    <div class="buttons-grid">
        <button class="area-btn" data-area="সৈয়দ পাড়ा"><i class="fas fa-mosque area-icon"></i>সৈয়দ পাড়া</button>
        <button class="area-btn" data-area="শেখ পাড়া"><i class="fas fa-home area-icon"></i>শেখ পাড়া</button>
        <button class="area-btn" data-area="ওয়ালি হাজ্বির বাড়ি"><i class="fas fa-kaaba area-icon"></i>ওয়ালি হাজ্বির বাড়ি</button>
        <button class="area-btn" data-area="কোরবান আলী হাজ্বির বাড়ি"><i class="fas fa-place-of-worship area-icon"></i>কোরবান আলী হাজ্বির বাড়ি</button>
        <button class="area-btn" data-area="হাবিবিয়া পাড়া"><i class="fas fa-home area-icon"></i>হাবিবিয়া পাড়া</button>
        <button class="area-btn" data-area="নাছির তালুকদার বাড়ি"><i class="fas fa-landmark area-icon"></i>নাছির তালুকদার বাড়ি</button>
        <button class="area-btn" data-area="তমিজ উদ্দিন মুন্সির বাড়ি"><i class="fas fa-house-user area-icon"></i>তমিজ উদ্দিন মুন্সির বাড়ি</button>
        <button class="area-btn" data-area="রশিদ বই"><i class="fas fa-book area-icon"></i>রশিদ বই</button>
        <button class="area-btn" data-area="ক্যাশ টেবিল"><i class="fas fa-money-bill-wave area-icon"></i>ক্যাশ টেবিল</button>
        <button class="area-btn" data-area="আয়-হিসাব"><i class="fas fa-hand-holding-usd area-icon"></i>আয়-হিসাব</button>
        <button class="area-btn" data-area="ব্যয়-হিসাব"><i class="fas fa-file-invoice-dollar area-icon"></i>ব্যয়-হিসাব</button>
    </div>

    <!-- চাঁদা টেবিল কন্টেইনার -->
    <div class="table-container" id="chandaTableContainer">
        <div class="table-header"><h2 class="table-title" id="chandaTableTitle">চাঁদার তালিকা</h2><button class="print-btn" id="printChandaBtn"><i class="fas fa-print"></i> প্রিন্ট</button></div>
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="chandaSearchInput" class="search-input" placeholder="ক্রমিক নং বা নাম দিয়ে সার্চ...">
            <div class="search-help"><i class="fas fa-info-circle"></i> টিপ: ক্রমিক নং (১,২,৩) বা নামের অংশ লিখুন</div>
        </div>
        <div class="loading" id="chandaLoadingIndicator"><div class="spinner"></div></div>
        <div class="no-results" id="chandaNoResults"><i class="fas fa-search"></i><h3>কোন ফলাফল নেই</h3></div>
        <table id="chandaTable">
            <thead><tr><th>ক্রমিক</th><th>নাম</th><th>চাঁদা</th><th>উসুল</th><th>হাদিয়া</th><th>পরিশোধ</th></tr></thead>
            <tbody id="chandaTableBody"></tbody>
        </table>
        <div class="summary" id="chandaSummarySection"></div>
    </div>

    <!-- রশিদ বই টেবিল -->
    <div class="table-container" id="rashidTableContainer">
        <div class="table-header"><h2 class="table-title" id="rashidTableTitle">রশিদ বই</h2><button class="print-btn" id="printRashidBtn"><i class="fas fa-print"></i> প্রিন্ট</button></div>
        <div class="search-container"><i class="fas fa-search search-icon"></i><input type="text" id="rashidSearchInput" class="search-input" placeholder="ক্রমিক/নাম/রশিদ নং"></div>
        <div class="loading" id="rashidLoadingIndicator"><div class="spinner"></div></div>
        <div class="no-results" id="rashidNoResults"><i class="fas fa-search"></i><h3>কোন ফলাফল নেই</h3></div>
        <table id="rashidTable"><thead><tr><th>ক্রমিক</th><th>নাম</th><th>রশিদ নং</th><th>টাকা</th><th>ঠিকানা</th></tr></thead><tbody id="rashidTableBody"></tbody></table>
        <div class="summary" id="rashidSummarySection"></div>
    </div>

    <!-- ক্যাশ টেবিল -->
    <div class="table-container cash-table" id="cashTableContainer">
        <div class="table-header"><h2 class="table-title" id="cashTableTitle">ক্যাশ টেবিল</h2><button class="print-btn" id="printCashBtn"><i class="fas fa-print"></i> প্রিন্ট</button></div>
        <div class="search-container"><i class="fas fa-search search-icon"></i><input type="text" id="cashSearchInput" class="search-input" placeholder="ক্রমিক/নাম"></div>
        <div class="loading" id="cashLoadingIndicator"><div class="spinner"></div></div>
        <div class="no-results" id="cashNoResults"><i class="fas fa-search"></i><h3>কোন ফলাফল নেই</h3></div>
        <table id="cashTable"><thead><tr><th>ক্রমিক</th><th>নাম</th><th>টাকা</th><th>ঠিকানা</th></tr></thead><tbody id="cashTableBody"></tbody></table>
        <div class="summary" id="cashSummarySection"></div>
    </div>

    <!-- আয় টেবিল -->
    <div class="table-container income-table" id="incomeTableContainer">
        <div class="table-header"><h2 class="table-title" id="incomeTableTitle">আয়-হিসাব</h2><button class="print-btn" id="printIncomeBtn"><i class="fas fa-print"></i> প্রিন্ট</button></div>
        <div class="search-container"><i class="fas fa-search search-icon"></i><input type="text" id="incomeSearchInput" class="search-input" placeholder="ক্রমিক/বিবরণ"></div>
        <div class="loading" id="incomeLoadingIndicator"><div class="spinner"></div></div>
        <div class="no-results" id="incomeNoResults"><i class="fas fa-search"></i><h3>কোন ফলাফল নেই</h3></div>
        <table id="incomeTable"><thead><tr><th>ক্রমিক</th><th>বিবরণ</th><th>টাকা</th></tr></thead><tbody id="incomeTableBody"></tbody></table>
        <div class="summary" id="incomeSummarySection"></div>
    </div>

    <!-- ব্যয় টেবিল -->
    <div class="table-container expense-table" id="expenseTableContainer">
        <div class="table-header"><h2 class="table-title" id="expenseTableTitle">ব্যয়-হিসাব</h2><button class="print-btn" id="printExpenseBtn"><i class="fas fa-print"></i> প্রিন্ট</button></div>
        <div class="search-container"><i class="fas fa-search search-icon"></i><input type="text" id="expenseSearchInput" class="search-input" placeholder="ক্রমিক/বিবরণ"></div>
        <div class="loading" id="expenseLoadingIndicator"><div class="spinner"></div></div>
        <div class="no-results" id="expenseNoResults"><i class="fas fa-search"></i><h3>কোন ফলাফল নেই</h3></div>
        <table id="expenseTable"><thead><tr><th>ক্রমিক</th><th>বিবরণ</th><th>টাকা</th></tr></thead><tbody id="expenseTableBody"></tbody></table>
        <div class="summary" id="expenseSummarySection"></div>
    </div>

    <footer>&copy; হযরত সৈয়দ ওয়াইছ উদ্দিন শাহ্ (রহঃ) ওরশ পরিচালনা কমিটি</footer>
</div>

<script>
(function() {
    // ---------- ইউটিলিটি ফাংশন (বাংলা সংখ্যা, কমা, হাইলাইট) ----------
    function toBengaliNumber(num) {
        const en = ['0','1','2','3','4','5','6','7','8','9'];
        const bn = ['০','১','২','৩','৪','৫','৬','৭','৮','৯'];
        return num.toString().split('').map(d => en.includes(d) ? bn[en.indexOf(d)] : d).join('');
    }
    function toEnglishNumber(bnStr) {
        const en = ['0','1','2','3','4','5','6','7','8','9'];
        const bn = ['০','১','২','৩','৪','৫','৬','৭','৮','৯'];
        return bnStr.toString().split('').map(ch => bn.includes(ch) ? en[bn.indexOf(ch)] : ch).join('');
    }
    function formatCurrency(amount) {
        let num = parseInt(amount) || 0;
        return toBengaliNumber(num.toLocaleString('en')) + ' টাকা';
    }
    function highlightText(text, term) {
        if (!term) return text;
        try {
            let escaped = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            let regex = new RegExp(`(${escaped})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        } catch (e) { return text; }
    }

    // ---------- গ্লোবাল ডেটা ----------
    let allChandaData = {
        "সৈয়দ পাড়া": [], "শেখ পাড়া": [], "ওয়ালি হাজ্বির বাড়ি": [], "কোরবান আলী হাজ্বির বাড়ি": [],
        "হাবিবিয়া পাড়া": [], "নাছির তালুকদার বাড়ি": [], "তমিজ উদ্দিন মুন্সির বাড়ি": []
    };
    let allRashidData = [], allCashData = [], allIncomeData = [], allExpenseData = [];

    // current filtered
    let currentChandaData = [], currentFilteredChanda = [];
    let currentFilteredRashid = [], currentFilteredCash = [], currentFilteredIncome = [], currentFilteredExpense = [];

    // এলিমেন্ট রেফ
    const containers = {
        chanda: document.getElementById('chandaTableContainer'),
        rashid: document.getElementById('rashidTableContainer'),
        cash: document.getElementById('cashTableContainer'),
        income: document.getElementById('incomeTableContainer'),
        expense: document.getElementById('expenseTableContainer')
    };
    const bodies = {
        chanda: document.getElementById('chandaTableBody'),
        rashid: document.getElementById('rashidTableBody'),
        cash: document.getElementById('cashTableBody'),
        income: document.getElementById('incomeTableBody'),
        expense: document.getElementById('expenseTableBody')
    };
    const summaries = {
        chanda: document.getElementById('chandaSummarySection'),
        rashid: document.getElementById('rashidSummarySection'),
        cash: document.getElementById('cashSummarySection'),
        income: document.getElementById('incomeSummarySection'),
        expense: document.getElementById('expenseSummarySection')
    };
    const noResults = {
        chanda: document.getElementById('chandaNoResults'),
        rashid: document.getElementById('rashidNoResults'),
        cash: document.getElementById('cashNoResults'),
        income: document.getElementById('incomeNoResults'),
        expense: document.getElementById('expenseNoResults')
    };
    const searchInputs = {
        chanda: document.getElementById('chandaSearchInput'),
        rashid: document.getElementById('rashidSearchInput'),
        cash: document.getElementById('cashSearchInput'),
        income: document.getElementById('incomeSearchInput'),
        expense: document.getElementById('expenseSearchInput')
    };
    const titles = {
        chanda: document.getElementById('chandaTableTitle'),
        rashid: document.getElementById('rashidTableTitle'),
        cash: document.getElementById('cashTableTitle'),
        income: document.getElementById('incomeTableTitle'),
        expense: document.getElementById('expenseTableTitle')
    };

    // ---------- রেন্ডার ফাংশন (সব টেবিল) ----------
    function renderChanda(data, filter='') {
        let html = '';
        data.forEach((item, idx) => {
            let serial = toBengaliNumber(idx+1);
            let name = filter ? highlightText(item.name, filter) : item.name;
            html += `<tr>
                <td>${filter ? highlightText(serial, filter) : serial}</td>
                <td>${name}</td>
                <td>${formatCurrency(item.chanda)}</td>
                <td>${formatCurrency(item.collection)}</td>
                <td>${formatCurrency(item.hadiya)}</td>
                <td class="${item.paid ? 'paid' : 'pending'}">${item.paid ? 'পরিশোধিত' : 'বাকি'}</td>
            </tr>`;
        });
        bodies.chanda.innerHTML = html || '<tr><td colspan="6" style="text-align:center;">কোন তথ্য নেই</td></tr>';
    }

    function renderRashid(data, filter='') {
        let html = '';
        data.forEach((item, idx) => {
            let serial = toBengaliNumber(idx+1);
            let name = filter ? highlightText(item.name, filter) : item.name;
            let rashid = filter && item.rashid_no ? highlightText(item.rashid_no, filter) : (item.rashid_no || '');
            html += `<tr>
                <td>${filter ? highlightText(serial, filter) : serial}</td>
                <td>${name}</td>
                <td>${rashid}</td>
                <td>${formatCurrency(item.amount)}</td>
                <td>${item.address || ''}</td>
            </tr>`;
        });
        bodies.rashid.innerHTML = html || '<tr><td colspan="5" style="text-align:center;">কোন তথ্য নেই</td></tr>';
    }

    function renderCash(data, filter='') {
        let html = '';
        data.forEach((item, idx) => {
            let serial = toBengaliNumber(idx+1);
            let name = filter ? highlightText(item.name, filter) : item.name;
            html += `<tr>
                <td>${filter ? highlightText(serial, filter) : serial}</td>
                <td>${name}</td>
                <td>${formatCurrency(item.amount)}</td>
                <td>${item.address || ''}</td>
            </tr>`;
        });
        bodies.cash.innerHTML = html || '<tr><td colspan="4" style="text-align:center;">কোন তথ্য নেই</td></tr>';
    }

    function renderIncome(data, filter='') {
        let html = '';
        data.forEach((item, idx) => {
            let serial = toBengaliNumber(idx+1);
            let desc = filter ? highlightText(item.description, filter) : item.description;
            html += `<tr>
                <td>${filter ? highlightText(serial, filter) : serial}</td>
                <td>${desc}</td>
                <td>${formatCurrency(item.amount)}</td>
            </tr>`;
        });
        bodies.income.innerHTML = html || '<tr><td colspan="3" style="text-align:center;">কোন তথ্য নেই</td></tr>';
    }

    function renderExpense(data, filter='') {
        let html = '';
        data.forEach((item, idx) => {
            let serial = toBengaliNumber(idx+1);
            let desc = filter ? highlightText(item.description, filter) : item.description;
            html += `<tr>
                <td>${filter ? highlightText(serial, filter) : serial}</td>
                <td>${desc}</td>
                <td>${formatCurrency(item.amount)}</td>
            </tr>`;
        });
        bodies.expense.innerHTML = html || '<tr><td colspan="3" style="text-align:center;">কোন তথ্য নেই</td></tr>';
    }

    // সারাংশ আপডেট
    function updateSummary(type, data) {
        let total = 0, count = data.length;
        let paid = 0, totalChanda=0, totalColl=0, totalHad=0;
        if (type === 'chanda') {
            data.forEach(p => {
                totalChanda += parseInt(p.chanda)||0;
                totalColl += parseInt(p.collection)||0;
                totalHad += parseInt(p.hadiya)||0;
                if(p.paid) paid++;
            });
            summaries.chanda.innerHTML = `
                <div class="summary-item"><span class="summary-label">মোট চাঁদা:</span><span class="summary-value">${formatCurrency(totalChanda)}</span></div>
                <div class="summary-item"><span class="summary-label">মোট উসুল:</span><span class="summary-value">${formatCurrency(totalColl)}</span></div>
                <div class="summary-item"><span class="summary-label">মোট হাদিয়া:</span><span class="summary-value">${formatCurrency(totalHad)}</span></div>
                <div class="summary-item"><span class="summary-label">পরিশোধিত:</span><span class="summary-value">${toBengaliNumber(paid)}</span></div>
                <div class="summary-item"><span class="summary-label">বাকি:</span><span class="summary-value">${toBengaliNumber(count-paid)}</span></div>
                <div class="summary-item"><span class="summary-label">মোট সারি:</span><span class="summary-value">${toBengaliNumber(count)}</span></div>
            `;
        } else if (type === 'rashid') {
            data.forEach(d => total += parseInt(d.amount)||0);
            summaries.rashid.innerHTML = `<div class="summary-item"><span class="summary-label">মোট রশিদ:</span><span class="summary-value">${toBengaliNumber(count)}টি</span></div>
                <div class="summary-item"><span class="summary-label">মোট টাকা:</span><span class="summary-value">${formatCurrency(total)}</span></div>
                <div class="summary-item"><span class="summary-label">গড়:</span><span class="summary-value">${formatCurrency(count?Math.round(total/count):0)}</span></div>`;
        } else if (type === 'cash') {
            data.forEach(d => total += parseInt(d.amount)||0);
            summaries.cash.innerHTML = `<div class="summary-item"><span class="summary-label">মোট ব্যক্তি:</span><span class="summary-value">${toBengaliNumber(count)}</span></div>
                <div class="summary-item"><span class="summary-label">মোট টাকা:</span><span class="summary-value">${formatCurrency(total)}</span></div>
                <div class="summary-item"><span class="summary-label">গড়:</span><span class="summary-value">${formatCurrency(count?Math.round(total/count):0)}</span></div>`;
        } else if (type === 'income') {
            data.forEach(d => total += parseInt(d.amount)||0);
            summaries.income.innerHTML = `<div class="summary-item"><span class="summary-label">মোট আয়:</span><span class="summary-value">${formatCurrency(total)}</span></div>
                <div class="summary-item"><span class="summary-label">আইটেম:</span><span class="summary-value">${toBengaliNumber(count)}</span></div>`;
        } else if (type === 'expense') {
            data.forEach(d => total += parseInt(d.amount)||0);
            summaries.expense.innerHTML = `<div class="summary-item"><span class="summary-label">মোট ব্যয়:</span><span class="summary-value">${formatCurrency(total)}</span></div>
                <div class="summary-item"><span class="summary-label">আইটেম:</span><span class="summary-value">${toBengaliNumber(count)}</span></div>`;
        }
    }

    // ---------- ফিল্টার ফাংশন ----------
    function filterTable(type, searchTerm) {
        let rawData, currentFiltered;
        if (type === 'chanda') rawData = currentChandaData;
        else if (type === 'rashid') rawData = allRashidData;
        else if (type === 'cash') rawData = allCashData;
        else if (type === 'income') rawData = allIncomeData;
        else rawData = allExpenseData;

        if (!searchTerm.trim()) {
            if (type === 'chanda') currentFilteredChanda = [...rawData];
            else if (type === 'rashid') currentFilteredRashid = [...rawData];
            else if (type === 'cash') currentFilteredCash = [...rawData];
            else if (type === 'income') currentFilteredIncome = [...rawData];
            else currentFilteredExpense = [...rawData];
        } else {
            let term = searchTerm.toLowerCase();
            let termEn = toEnglishNumber(term);
            let filtered = rawData.filter((item, idx) => {
                let serialBn = toBengaliNumber(idx+1);
                let serialEn = (idx+1).toString();
                let matchesSerial = serialBn.includes(term) || serialEn.includes(termEn);
                if (type === 'chanda') return matchesSerial || item.name.toLowerCase().includes(term);
                if (type === 'rashid') return matchesSerial || item.name.toLowerCase().includes(term) || (item.rashid_no && item.rashid_no.includes(term));
                if (type === 'cash') return matchesSerial || item.name.toLowerCase().includes(term);
                if (type === 'income') return matchesSerial || item.description.toLowerCase().includes(term);
                return matchesSerial || item.description.toLowerCase().includes(term);
            });
            if (type === 'chanda') currentFilteredChanda = filtered;
            else if (type === 'rashid') currentFilteredRashid = filtered;
            else if (type === 'cash') currentFilteredCash = filtered;
            else if (type === 'income') currentFilteredIncome = filtered;
            else currentFilteredExpense = filtered;
        }

        // রেন্ডার ও সারাংশ
        let displayData, renderFn, summaryType;
        if (type === 'chanda') { displayData = currentFilteredChanda; renderFn = renderChanda; summaryType='chanda'; }
        else if (type === 'rashid') { displayData = currentFilteredRashid; renderFn = renderRashid; summaryType='rashid'; }
        else if (type === 'cash') { displayData = currentFilteredCash; renderFn = renderCash; summaryType='cash'; }
        else if (type === 'income') { displayData = currentFilteredIncome; renderFn = renderIncome; summaryType='income'; }
        else { displayData = currentFilteredExpense; renderFn = renderExpense; summaryType='expense'; }

        if (displayData.length === 0) {
            bodies[type].innerHTML = '';
            noResults[type].style.display = 'block';
            summaries[type].innerHTML = '';
        } else {
            noResults[type].style.display = 'none';
            renderFn(displayData, searchTerm);
            updateSummary(summaryType, displayData);
        }
    }

    // ---------- শো ফাংশন (বাটন চাপলে) ----------
    function showChandaArea(area) {
        titles.chanda.innerText = `${area} – চাঁদার তালিকা`;
        currentChandaData = allChandaData[area] || [];
        currentFilteredChanda = [...currentChandaData];
        searchInputs.chanda.value = '';
        noResults.chanda.style.display = 'none';
        if (currentChandaData.length) {
            renderChanda(currentChandaData);
            updateSummary('chanda', currentChandaData);
        } else {
            bodies.chanda.innerHTML = '<tr><td colspan="6" style="text-align:center;">এই এলাকায় কোনো তথ্য নেই</td></tr>';
            summaries.chanda.innerHTML = '';
        }
        containers.chanda.style.display = 'block';
        containers.rashid.style.display = 'none'; containers.cash.style.display = 'none';
        containers.income.style.display = 'none'; containers.expense.style.display = 'none';
    }

    function showRashid() {
        titles.rashid.innerText = 'রশিদ বই তালিকা';
        searchInputs.rashid.value = '';
        noResults.rashid.style.display = 'none';
        currentFilteredRashid = [...allRashidData];
        if (allRashidData.length) { renderRashid(allRashidData); updateSummary('rashid', allRashidData); }
        else { bodies.rashid.innerHTML = '<tr><td colspan="5">কোন তথ্য নেই</td></tr>'; summaries.rashid.innerHTML = ''; }
        containers.rashid.style.display = 'block';
        containers.chanda.style.display = 'none'; containers.cash.style.display = 'none';
        containers.income.style.display = 'none'; containers.expense.style.display = 'none';
    }

    function showCash() {
        titles.cash.innerText = 'ক্যাশ টেবিল';
        searchInputs.cash.value = '';
        noResults.cash.style.display = 'none';
        currentFilteredCash = [...allCashData];
        if (allCashData.length) { renderCash(allCashData); updateSummary('cash', allCashData); }
        else { bodies.cash.innerHTML = '<tr><td colspan="4">কোন তথ্য নেই</td></tr>'; summaries.cash.innerHTML = ''; }
        containers.cash.style.display = 'block';
        containers.chanda.style.display = 'none'; containers.rashid.style.display = 'none';
        containers.income.style.display = 'none'; containers.expense.style.display = 'none';
    }

    function showIncome() {
        titles.income.innerText = 'আয়-হিসাব';
        searchInputs.income.value = '';
        noResults.income.style.display = 'none';
        currentFilteredIncome = [...allIncomeData];
        if (allIncomeData.length) { renderIncome(allIncomeData); updateSummary('income', allIncomeData); }
        else { bodies.income.innerHTML = '<tr><td colspan="3">কোন তথ্য নেই</td></tr>'; summaries.income.innerHTML = ''; }
        containers.income.style.display = 'block';
        containers.chanda.style.display = 'none'; containers.rashid.style.display = 'none';
        containers.cash.style.display = 'none'; containers.expense.style.display = 'none';
    }

    function showExpense() {
        titles.expense.innerText = 'ব্যয়-হিসাব';
        searchInputs.expense.value = '';
        noResults.expense.style.display = 'none';
        currentFilteredExpense = [...allExpenseData];
        if (allExpenseData.length) { renderExpense(allExpenseData); updateSummary('expense', allExpenseData); }
        else { bodies.expense.innerHTML = '<tr><td colspan="3">কোন তথ্য নেই</td></tr>'; summaries.expense.innerHTML = ''; }
        containers.expense.style.display = 'block';
        containers.chanda.style.display = 'none'; containers.rashid.style.display = 'none';
        containers.cash.style.display = 'none'; containers.income.style.display = 'none';
    }

    // ---------- ডেটা পার্স (TYPE কলাম) ----------
    function processSheetData(rows) {
        // রিসেট
        for (let k in allChandaData) allChandaData[k] = [];
        allRashidData = []; allCashData = []; allIncomeData = []; allExpenseData = [];

        rows.forEach(row => {
            let type = (row.type || row.ধরন || row.Type || '').toString().toLowerCase();
            if (type.includes('চাঁদা') || type.includes('chanda')) {
                let area = row.area || row.এলাকা || '';
                if (area && allChandaData.hasOwnProperty(area)) {
                    allChandaData[area].push({
                        name: row.name || row.নাম || '',
                        chanda: row.chanda || row.চাঁদা || '0',
                        collection: row.collection || row.উসুল || '0',
                        hadiya: row.hadiya || row.হাদিয়া || '0',
                        paid: (row.paid === 'হ্যাঁ' || row.paid === '1' || row.paid === 'true' || row.paid === 'পরিশোধিত') ? true : false
                    });
                }
            } else if (type.includes('রশিদ') || type.includes('rashid')) {
                allRashidData.push({
                    name: row.name || row.নাম || '',
                    rashid_no: row.rashid_no || row.রশিদ || '',
                    amount: row.amount || row.টাকা || '0',
                    address: row.address || row.ঠিকানা || ''
                });
            } else if (type.includes('ক্যাশ') || type.includes('cash')) {
                allCashData.push({
                    name: row.name || row.নাম || '',
                    amount: row.amount || row.টাকা || '0',
                    address: row.address || row.ঠিকানা || ''
                });
            } else if (type.includes('আয়') || type.includes('income')) {
                allIncomeData.push({
                    description: row.description || row.বিবরণ || '',
                    amount: row.amount || row.টাকা || '0'
                });
            } else if (type.includes('ব্যয়') || type.includes('expense') || type.includes('খরচ')) {
                allExpenseData.push({
                    description: row.description || row.বিবরণ || '',
                    amount: row.amount || row.টাকা || '0'
                });
            }
        });
    }

    // ---------- গুগল শিট লোড ----------
    function loadFromSheets() {
        const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR6e85SNjq6MWpbd2f9wgFdUBqpQ6lx3FtLxJbWW72rb_elJ9gLXNhRDyELcfVqXYr3_hLxEtZNlrZf/pub?output=csv';
        Papa.parse(sheetURL, { download: true, header: true, complete: (res) => {
            processSheetData(res.data);
            // ডিফল্ট প্রথম এলাকা দেখাও
            showChandaArea('সৈয়দ পাড়া');
            document.querySelector('.area-btn')?.classList.add('active');
        }, error: (e) => { alert('ডেটা লোডে সমস্যা: '+e); } });
    }

    // ---------- ইভেন্ট লিসেনার ----------
    document.querySelectorAll('.area-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            let area = this.dataset.area;
            if (area === 'রশিদ বই') showRashid();
            else if (area === 'ক্যাশ টেবিল') showCash();
            else if (area === 'আয়-হিসাব') showIncome();
            else if (area === 'ব্যয়-হিসাব') showExpense();
            else showChandaArea(area);
        });
    });

    // সার্চ ইভেন্ট
    searchInputs.chanda.addEventListener('input', e => filterTable('chanda', e.target.value));
    searchInputs.rashid.addEventListener('input', e => filterTable('rashid', e.target.value));
    searchInputs.cash.addEventListener('input', e => filterTable('cash', e.target.value));
    searchInputs.income.addEventListener('input', e => filterTable('income', e.target.value));
    searchInputs.expense.addEventListener('input', e => filterTable('expense', e.target.value));

    // প্রিন্ট বাটন (সকল কন্টেইনারের জন্য)
    document.getElementById('printChandaBtn').addEventListener('click', () => window.print());
    document.getElementById('printRashidBtn').addEventListener('click', () => window.print());
    document.getElementById('printCashBtn').addEventListener('click', () => window.print());
    document.getElementById('printIncomeBtn').addEventListener('click', () => window.print());
    document.getElementById('printExpenseBtn').addEventListener('click', () => window.print());

    // শুরু
    loadFromSheets();
})();
</script>
</body>
</html>
